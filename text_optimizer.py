import anthropic
from anthropic.types.beta.messages.batch_create_params import Request
from anthropic.types.beta.message_create_params import MessageCreateParamsNonStreaming
import os
import asyncio
from pathlib import Path
import logging
import time
from tqdm import tqdm

# Configure logging
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s'
)

class BatchProcessor:
    def __init__(self, api_key: str, base_dir: str):
        self.client = anthropic.Anthropic(api_key=api_key)
        self.base_dir = Path(base_dir)
        self.system_prompt = """You are an expert language editor specializing in optimizing Czech text for voice synthesis. Your task is to modify the given text to make it optimal for reading aloud. 
Follow these instructions to modify the text:
1. Remove all numerical references, footnotes, and page numbers.
2. Join words that are hyphenated at the end of lines.
3. Remove excessive spaces and empty lines.
4. Preserve correct punctuation and sentence structure.
5. Maintain italics and other meaningful text formatting if marked.
6. Adjust the text to be natural for reading aloud while preserving the original meaning.
7. Return only the modified text without any comments or explanations."""

    def read_file_content(self, file_path: Path) -> str:
        """Reads the content of a text file and returns it as a string."""
        try:
            with open(file_path, 'r', encoding='utf-8') as file:
                return file.read()
        except FileNotFoundError:
            logging.error(f"File not found: {file_path}")
            return ""
        except Exception as e:
            logging.error(f"Error reading {file_path}: {e}")
            return ""

    def write_optimized_content(self, file_path: Path, content: str) -> None:
        """Writes the optimized content to a new file."""
        try:
            optimized_path = file_path.with_name(f"{file_path.stem}-OPTIMIZED{file_path.suffix}")
            with open(optimized_path, 'w', encoding='utf-8') as file:
                file.write(content)
            logging.info(f"Successfully wrote optimized content to {optimized_path}")
        except Exception as e:
            logging.error(f"Error writing to {optimized_path}: {e}")

    def prepare_batch_requests(self, files_to_process: list[str]) -> list[Request]:
        """Prepares batch requests for processing."""
        requests = []
        # Store filename mapping for later use
        self.custom_id_to_filename = {}
        for idx, filename in enumerate(files_to_process, 1):
            file_path = self.base_dir / filename
            content = self.read_file_content(file_path)
            
            if content:
                custom_id = f"req_{idx}"
                self.custom_id_to_filename[custom_id] = filename
                request = Request(
                    custom_id=custom_id,
                    params=MessageCreateParamsNonStreaming(
                        model="claude-3-5-haiku-20241022",
                        max_tokens=8192,
                        temperature=0,
                        system=self.system_prompt,
                        messages=[{
                            "role": "user",
                            "content": [
                                {
                                    "type": "text",
                                    "text": "<examples>\n<example>\n<CZECH_TEXT>\nČÁST PRVNÍ\nLidské jednání\nI. JEDNAJÍCÍ ČLOVĚK\n1. Účelové jednání a zvířecí reakce\nLidské jednání je účelové chování. Či jinak řečeno: Jednání je působící vůle\nuvedená v činnost, směřuje k cílům, je smysluplnou odpovědí ega na pod-\nmínky a stimuly z jeho prostředí, je vědomým přizpůsobením osoby stavu\nsvěta, jenž určuje její život. Uvedené parafráze snad vyjasní danou definici\na zabrání možným dezinterpretacím. Definice sama je nicméně adekvátní\na nevyžaduje žádné doplňky či komentáře.\nVědomé či účelové chování je v příkrém rozporu s nevědomým chováním,\ntj. s reflexy a nedobrovolnými odpověďmi tělních buněk a nervů na přichá-\nzející stimuly. Lidé se někdy domnívají, že hranice mezi vědomým chováním\na nedobrovolnou reakcí sil působících uvnitř lidského těla jsou více méně\nneurčité. Platí to jen do té míry, že je někdy obtížné stanovit, zda má být něja-\nké konkrétní jednání považováno za dobrovolné, či nedobrovolné. Rozdíl\nmezi vědomým a nevědomým je nicméně ostrý a lze jej jasně určit.\nNevědomé chování tělních orgánů a buněk představuje pro jednající ego\nstejná data jako jakýkoli jiný fakt vnějšího světa. Jednající člověk musí brát\nv úvahu vše, co se děje uvnitř jeho vlastního těla, stejně jako bere v úvahu\nostatní data, například počasí či postoje svých sousedů. Existuje samozřejmě\nurčitá mez, kde má účelové chování moc neutralizovat fungování tělesných\nfaktorů. V rámci jistých limitů je možné dostat tělo pod kontrolu. Člověk\nněkdy může silou své vůle přemoci nemoc, nahradit vrozené či získané nedo-\nstatky své fyzické konstituce či potlačit reflexy. Do té míry, do níž je to\nmožné, dochází k rozšiřování pole účelového jednání. Jestliže se člověk zdrží\novládnutí nedobrovolných reakcí buněk a nervových center, ačkoli by tak\nmohl činit, je jeho chování z našeho pohledu účelové.\n11\n01_Lidske jednani_final.qxd 5.5.2006 16:01 StrÆnka 11\n\nPředmětem naší vědy je lidské jednání, nikoli psychologické události,\nkteré jednání předcházejí. Právě toto odlišuje obecnou teorii lidského jedná-\nní, praxeologii, od psychologie. Tématem psychologie jsou vnitřní události,\nkteré ústí či mohou ústit do konkrétního jednání. Tématem praxeologie je jed-\nnání jako takové. Tím je rovněž upraven vztah praxeologie k psychoanalytic-\nkému konceptu podvědomí. Psychoanalýza je také psychologií a nezkoumá\njednání, nýbrž síly a faktory, které člověka ke konkrétnímu jednání nutí. Psy-\nchoanalytické podvědomí je psychologickou, nikoli praxeologickou kategorií.\nZda jednání vychází z jasného rozvažování, nebo je vůle řízena zapomenutý-\nmi vzpomínkami a potlačenými přáními, nemá na podstatu jednání vliv. Jak\nvrah, který je k zločinu veden podvědomým nutkáním (Id), tak i neurotik,\njehož nenormální chování připadá nezkušenému pozorovateli jednoduše\nnesmyslné, jednají. Stejně jako každý jiný i oni směřují k jistým cílům. Je\nzásluhou psychoanalýzy, že ukázala, že i jednání neurotiků a psychopatů má\nsmysl, že i oni jednají a směřují k cílům, ačkoli my, kdo se považujeme za\nzdravé a rozumné, považujeme uvažování určující jejich volbu cílů za nesmy-\nslné a prostředky, které si k dosažení těchto cílů vybírají, za odporující sledo-\nvanému účelu.\nTermín „nevědomý“, tak jak jej používá praxeologie, a termíny „podvědo-\nmý“ a „nevědomý“, jak je aplikuje psychoanalýza, náležejí do dvou odlišných\nsystémů myšlení a výzkumu. Praxeologie stejně jako ostatní odvětví vědění\nvděčí psychoanalýze za mnohé. Tím důležitější je proto uvědomit si hranici,\nkterá praxeologii od psychoanalýzy odděluje.\nJednání nepředstavuje pouhé udávání preferencí. Člověk projevuje prefe-\nrence rovněž v situacích, v nichž jsou věci a události nevyhnutelné či se jako\nnevyhnutelné jeví. Člověk tak může preferovat slunce před deštěm a může si\npřát, aby slunce mraky rozehnalo. Ten, kdo si pouze přeje a doufá, nezasahu-\nje aktivně do běhu událostí a vlastního osudu. Jednající člověk naproti tomu\nvolí, určuje a pokouší se dosáhnout cíle. Ze dvou věcí, které nemůže mít sou-\nčasně, si vybírá jednu a vzdává se druhé. Jednání proto vždy zahrnuje braní\ni zřeknutí se.\nVyjádření přání a nadějí či oznámení plánovaného jednání může být jistou\nformou jednání, pokud samo směřuje k naplnění jistého účelu. Nesmí však\nbýt zaměňováno s jednáním, na které odkazuje. Není totožné s jednáním,\nkteré oznamuje, doporučuje nebo odmítá. Jednání je reálnou věcí. Počítá se\ncelkové chování člověka, nikoli pouhé mluvení o plánovaných, avšak neu-\nskutečněných aktech. Na druhou stranu je třeba jednání jasně odlišit od\nvykonávání práce. Jednání znamená použití prostředků pro dosažení cílů.\nZpravidla je jedním z těchto prostředků lidská práce. Nemusí to tak ale být\nvždy. Za jistých specifických okolností postačí slovo. Ten, kdo vydává příka-\nzy či zákazy, může jednat, aniž by konal práci. Mluvit či mlčet, smát se či\n12\n01_Lidske jednani_final.qxd 5.5.2006 16:01 StrÆnka 12\n\nzůstat vážný, to vše může být jednáním. Spotřebovávat a užívat si je jednáním\nstejně jako zdržet se dostupné spotřeby a zábavy.\nPraxeologie tedy nerozlišuje mezi „aktivním“ či energickým a „pasivním“\nči netečným člověkem. Rázný člověk, pilně se snažící zlepšit své vlastní pod-\nmínky, nejedná ani více, ani méně než člověk letargický, který odevzdaně\npřijímá věci tak, jak na něj dopadají. Nedělat nic a být nečinný je totiž také\njednání, i ono určuje běh věcí. Kdekoli jsou přítomny podmínky pro lidský\nzásah, jedná člověk bez ohledu na to, zda zasáhne či nikoli. Ten, kdo snáší, co\nby mohl změnit, nejedná o nic méně než ten, kdo za účelem dosáhnout odliš-\nného výsledku zasáhne. Jedná i člověk, který se zdrží ovlivňování působení\nfyziologických a instinktivních faktorů, které mohl ovlivnit. Jednat nezname-\nná pouze něco dělat, ale i neudělat něco, co uděláno být mohlo.\nMůžeme říci, že jednání je projevením lidské vůle. To by však k našemu\npoznání nic nepřidalo, neboť termín vůle neznamená nic jiného než schop-\nnost člověka volit mezi různými stavy věcí, preferovat jednu věc, obětovat\njinou a dále se chovat dle učiněného rozhodnutí s cílem dosáhnout zvolené-\nho stavu a vzdát se stavů ostatních.\n2. Předpoklady lidského jednání\nSpokojeností či uspokojením nazýváme takový stav lidské bytosti, který\nnevede a nemůže vést k jednání. Jednající člověk chce nahradit méně uspo-\nkojivý stav věcí stavem uspokojivějším. Jeho mysl si představuje podmínky,\njež by mu vyhovovaly lépe, a jednání směruje k dosažení tohoto žádoucího\nstavu. Incentivem, který nutí člověka jednat, je vždy pociťovaná nespokoje-\nnost.\n1 \nČlověk dokonale spokojený se stavem svých věcí by neměl žádný\nincentiv něco měnit. Neměl by ani přání, ani touhy; byl by dokonale spokoje-\nný. Nejednal by; jednoduše by žil, aniž by se o cokoli staral.\nNespokojenost a vidina uspokojivějšího stavu však samy o sobě nestačí\nk tomu, aby člověk jednal. Je třeba ještě třetí podmínky: očekávání, že má\núčelové chování moc odstranit či alespoň zmírnit pociťovanou nespokojenost.\nBez této podmínky není žádné jednání myslitelné. Člověk se musí podřídit\nnevyhnutelnému, podrobit se osudu.\nToto jsou tedy obecné podmínky lidského jednání, podmínky, za kterých\nčlověk žije. Není pouze homo sapiens, ale také homo agens. Potomci člověka,\nkteří jsou ať již v důsledku vrozených či získaných postižení neodstranitelně\n13\n1 \nSrov. Locke, An Essay Concerning Human Understanding, ed. Fraser (Oxford, 1894),\nI, 331—333; Leibniz, Nouveaux essais sur l’entendement humain, ed. Fammarion,\nstr. 119.\n01_Lidske jednani_final.qxd 5.5.2006 16:01 StrÆnka 13\n\nneschopni jakéhokoli jednání, nejsou (v přísném smyslu toho termínu, niko-\nli pouze ve smyslu právním) ve skutečnosti lidmi. Ačkoli je zákony a biologie\npovažují za lidi, postrádají základní vlastnost lidství. Ani nově narozené dítě\nnení jednající bytostí. Ještě neurazilo celou cestu od početí k plnému rozvoji\nsvých lidských kvalit. Na konci tohoto vývoje se však lidskou bytostí stane.\nO štěstí\nV běžné řeči říkáme o člověku, že je šťastný, pokud se mu podaří dosáh-\nnout svých cílů. Přesněji bychom jeho stav měli popsat tak, že je šťastnější,\nnež byl předtím. Proti zvyku, který definuje lidské jednání jako snahu o dosa-\nžení štěstí, však neexistuje žádná platná námitka.\nMusíme se nicméně vyhnout běžným nedorozuměním. Konečným cílem\nlidského jednání je vždy uspokojení přání jednajícího. Mimo individuálních\nhodnotových soudů, které se liší člověk od člověka i u jednoho člověka v růz-\nném čase, neexistuje žádný standard většího či menšího uspokojení. Člověk\nsi určuje sám, dle standardů vlastní vůle a soudů, svým vlastním subjektiv-\nním hodnocením, co jej činí nespokojeným a méně nespokojeným. Nikdo\nnení v pozici, aby mohl určit, co udělá člověka šťastnějším.\nUvedené skutečnosti se nijak nevztahují k antitezím egoismu a altruismu,\nmaterialismu a idealismu, individualismu a kolektivismu, ateismu a nábožen-\nství. Existují lidé, jejichž jediným cílem je zlepšit podmínky svého vlastního\nega. Jiným lidem naopak vědomí utrpení jejich druhů způsobuje neméně či\ndokonce ještě více nespokojenosti než potřeby jejich vlastní. Někteří lidé si\nnepřejí nic jiného než uspokojení svých chutí po sexuálních vztazích, jídle,\npití, dobrém bydlení a dalších hmotných věcech. Jiní lidé se však více starají\no uspokojení potřeb, kterým obvykle říkáme „vyšší“ či „duchovní“. Někteří\ntouží přizpůsobit své jednání požadavkům společenské spolupráce; na druhé\nstraně existují vzpurní lidé, kteří jakýmkoli pravidlům společenského života\nvzdorují. Pro některé lidi je konečným cílem pozemské pouti příprava na\nživot v blaženosti. Někteří lidé nevěří v učení žádného z náboženství a nedo-\nvolují, aby jejich život ovlivňovalo.\nPraxeologie je vůči konečným cílům jednání indiferentní. Její závěry jsou\nplatné pro všechny typy jednání bez ohledu na to, k jakým cílům směřují. Je\nvědou o prostředcích, nikoli o cílech. Termín štěstí používá v čistě formálním\nsmyslu. V praxeologické terminologii je věta: „Jediným cílem člověka je\ndosáhnout štěstí“ tautologická. Neříká nic o stavu věcí, od něhož člověk štěs-\ntí očekává.\nMyšlenka, že incentivem lidské aktivity je vždy nějaká nespokojenost\na jejím cílem maximální možné odstranění této nespokojenosti, tedy obšťast-\nnění člověka, je podstatou učení eudaimonismu a hédonismu. Epikurejské\nataraxia je stavem dokonalého štěstí a uspokojení, k němuž směřuje veškeré\n14\n01_Lidske jednani_final.qxd 5.5.2006 16:01 StrÆnka 14\n\nlidské jednání, aniž by jej mohlo kdy plně dosáhnout. Vzhledem k velikosti\ntéto myšlenky je jen zcela nepodstatné, že mnozí zástupci této filozofie neroz-\npoznali čistě formální charakter strasti a radosti a přiřazovali jim materiální\na tělesný význam. Teologické, mystické a další školy heteronomní etiky jád-\nrem epikurejství neotřásly, neboť vůči němu nebyly schopny vznést žádnou\njinou námitku, než že opomíjí „vyšší“ a „ctnostnější“ radosti. Je pravda, že\nmnohé z raných prací zastánců epikurejství, eudaimonismu, hédonismu a uti-\nlitarismu jsou v některých aspektech náchylné k dezinterpretacím. Jazyk\nmoderních filozofů a ještě více moderních ekonomů je ale tak přesný a jed-\nnoznačný, že k žádné dezinterpretaci dojít nemůže.\nO instinktech a pudech\nPorozumění základním problémům lidského jednání nelze nijak posunout\nmetodami instinktivní sociologie. Tato škola klasifikuje různé konkrétní cíle\nlidského jednání a každé třídě přisuzuje jako její motiv nějaký instinkt. Člo-\nvěk se jeví jako bytost poháněná různými vrozenými instinkty a tempera-\nmenty. Má se za to, že toto vysvětlení jednou provždy vyvrací odporné učení\nekonomie a utilitární etiky. Avšak již Feuerbach správně ukázal, že každý\ninstinkt je instinktem ke štěstí. \n2 \nMetoda instinktivní psychologie a instinktiv-\nní sociologie spočívá v arbitrární klasifikaci bezprostředních cílů jednání\na v jejich zvěcnění. Zatímco praxeologie říká, že cílem jednání je odstranění\njisté nespokojenosti, instinktivní psychologie tvrdí, že je jím uspokojení\ninstinktivního pudu.\nMnozí zastánci instinktivní školy jsou přesvědčeni, že dokázali, že jednání\nnení určováno rozumem, nýbrž vyplývá z hlubin vrozených sil, pudů, instink-\ntů a dispozic, které nelze nijak racionálně osvětlit. Jsou si naprosto jisti svým\núspěchem při odhalování plytkosti racionalismu a při znevažování ekonomie\ncoby „souboru mylných vývodů, založeném na chybných psychologických\npředpokladech“.\n3 \nRacionalismus, praxeologie a ekonomie však nepojednáva-\njí o konečných zdrojích a cílech jednání. Zabývají se použitím prostředků\nk dosažení sledovaných cílů. Jakkoli neuchopitelná může být hloubka, v níž\npudy a instinkty vznikají, prostředky, které člověk volí pro jejich uspokojení,\njsou určovány racionálním zvážením nákladů a úspěchu.\n4\n15\n2 \nSrov. Feuerbach, Sämmtliche Werke, ed. Bolin a Jodl (Stuttgart, 1907), X, str. 231.\n3 \nSrov. William McDougall, An Introduction to Social Psychology (14. vyd., Boston, 1921),\nstr. 11.\n4 \nSrov. Mises, Epistemological Problems of Economics, přeložil G. Reisman (New York,\n1960), str. 52 a násl.\n01_Lidske jednani_final.qxd 5.5.2006 16:01 StrÆnka 15\n\nTen, kdo jedná na základě emocionálních pudů, také jedná. Od ostatních\ntypů jednání se emocionální jednání odlišuje jiným hodnocením vstupů\na výstupů. Emoce narušují hodnocení. Člověk rozvášněný emocemi považuje\ncíle za daleko více žádoucí a cenu, kterou musí zaplatit, za nižší, než kdyby\nměl chladnou hlavu. Lidé nikdy nepochybovali, že dokonce i v emocionálně\nvypjatém stavu zvažují prostředky a cíle a že je možné ovlivnit výsledek toho-\nto rozhodování tím, že se zvýší náklady podlehnutí pudům vášně. Trestat mír-\nněji trestné činy spáchané ve stavu emocionálního vzrušení či pod vlivem\ndrog znamená tyto excesy podporovat. Není pravda, že hrozba přísného\npotrestání neodradí lidi vedené zdánlivě nepřemožitelnou vášní.\nChování zvířat interpretujeme na základě předpokladu, že zvířata podlé-\nhají momentálním pudům. Když pozorujeme, jak se zvířata živí, mají potom-\nstvo a napadají ostatní zvířata či lidi, hovoříme o potravním instinktu, repro-\ndukčním instinktu či instinktu k agresivitě. Předpokládáme, že jsou vrozené\na vytrvale žádají své uspokojení.\nS lidmi je to ale jinak. Člověk není bytostí, která by se nedokázala vzepřít\ninstinktům, jež nejnaléhavěji volají po svém uspokojení. Člověk dokáže\nemoce a pudy potlačit. Dokáže racionalizovat své chování. Zřekne se uspo-\nkojení nutkavého pudu, jen aby uspokojil ostatní přání. Není loutkou v rukou\nsvých choutek. Muž se nevrhá na každou ženu, která zjitří jeho smysly,\nnezhltne každý kousek jídla, který jej zláká, nesrazí každého člověka, které-\nho by si přál zabít. Svá přání a tužby uspořádává do škály, volí, či krátce řeče-\nno, jedná. Právě to, že člověk vědomě uspořádává své chování, jej odlišuje od\nzvířat. Člověk je bytostí se zábranami, která ovládá své pudy a touhy, která\nmá moc instinktivní přání a pudy potlačit.\nMůže se stát, že se pud objeví s takovou naléhavostí, že žádná nevýhoda,\nkterou by jeho uspokojení mohlo přinést, se nezdá natolik velká, aby zabrá-\nnila jeho naplnění. I zde se objevuje volba. Člověk se rozhoduje pro podleh-\nnutí danému přání.\n5\n3. Lidské jednání jako konečná danost\nČlověk od nepaměti toužil poznat prvotního hybatele, příčinu všech věcí\na všech změn, poslední substanci, z níž vše povstává a která je příčinou sebe\nsama. Věda je skromnější. Je si vědoma omezení lidské mysli a lidské snahy\npoznávat. Jejím cílem je vystopovat všechny jevy k jejich příčinám. Chápe\n16\n5 \nVelkou roli hraje v těchto případech okolnost, že ona dvě uspokojení – uspokojení\nočekávané z podlehnutí pudu a uspokojení vyplývající z vyhnutí se nechtěným\ndůsledkům – nenastávají ve stejném čase. Srov. níže, str. 431—441.\n01_Lidske jednani_final.qxd 5.5.2006 16:01 StrÆnka 16\n\nvšak, že tato snaha musí nutně narazit na nepřekonatelné překážky. Jsou\njevy, které nelze analyzovat a vysvětlit pomocí jiných jevů. Jsou konečnou\ndaností. Pokrok vědeckého zkoumání může odhalit, že něco, dříve považova-\nné za konečnou danost, lze rozložit na další součásti. Vždy však bude existo-\nvat nějaký neredukovatelný a dále neanalyzovatelný jev, nějaká konečná\ndanost.\n</CZECH_TEXT>\n<ideal_output>\nLidské jednání\n\nČÁST PRVNÍ: JEDNAJÍCÍ ČLOVĚK\n\nÚčelové jednání a zvířecí reakce\n\nLidské jednání je účelové chování. Či jinak řečeno: Jednání je působící vůle uvedená v činnost, směřuje k cílům, je smysluplnou odpovědí ega  na podmínky a stimuly z jeho prostředí, je vědomým přizpůsobením osoby stavu světa, jenž určuje její život. Uvedené parafráze snad vyjasní danou definici a zabrání možným dezinterpretacím. Definice sama je nicméně adekvátní a nevyžaduje žádné doplňky či komentáře.\n\nVědomé či účelové chování je v příkrém rozporu s nevědomým chováním, tj. s reflexy a nedobrovolnými odpověďmi tělních buněk a nervů na přicházející stimuly. Lidé se někdy domnívají, že hranice mezi vědomým chováním a nedobrovolnou reakcí sil působících uvnitř lidského těla jsou více méně neurčité. Platí to jen do té míry, že je někdy obtížné stanovit, zda má být nějaké konkrétní jednání považováno za dobrovolné, či nedobrovolné. Rozdíl mezi vědomým a nevědomým je nicméně ostrý a lze jej jasně určit.\n\nNevědomé chování tělních orgánů a buněk představuje pro jednající ego stejná data jako jakýkoli jiný fakt vnějšího světa. Jednající člověk musí brát v úvahu vše, co se děje uvnitř jeho vlastního těla, stejně jako bere v úvahu ostatní data, například počasí či postoje svých sousedů. Existuje samozřejmě určitá mez, kde má účelové chování moc neutralizovat fungování tělesných faktorů. V rámci jistých limitů je možné dostat tělo pod kontrolu. Člověk někdy může silou své vůle přemoci nemoc, nahradit vrozené či získané nedostatky své fyzické konstituce či potlačit reflexy. Do té míry, do níž je to možné, dochází k rozšiřování pole účelového jednání. Jestliže se člověk zdrží ovládnutí nedobrovolných reakcí buněk a nervových center, ačkoli by tak mohl činit, je jeho chování z našeho pohledu účelové.\n\nPředmětem naší vědy je lidské jednání, nikoli psychologické události, které jednání předcházejí. Právě toto odlišuje obecnou teorii lidského jednání, praxeologii, od psychologie. Tématem psychologie jsou vnitřní události, které ústí či mohou ústit do konkrétního jednání. Tématem praxeologie je jednání jako takové. Tím je rovněž upraven vztah praxeologie k psychoanalytic-kému konceptu podvědomí. Psychoanalýza je také psychologií a nezkoumá jednání, nýbrž síly a faktory, které člověka ke konkrétnímu jednání nutí. Psy-choanalytické podvědomí je psychologickou, nikoli praxeologickou kategorií.\n\nZda jednání vychází z jasného rozvažování, nebo je vůle řízena zapomenutý-mi vzpomínkami a potlačenými přáními, nemá na podstatu jednání vliv. Jak vrah, který je k zločinu veden podvědomým nutkáním (Id), tak i neurotik, jehož nenormální chování připadá nezkušenému pozorovateli jednoduše nesmyslné, jednají. Stejně jako každý jiný i oni směřují k jistým cílům. Je zásluhou psychoanalýzy, že ukázala, že i jednání neurotiků a psychopatů má smysl, že i oni jednají a směřují k cílům, ačkoli my, kdo se považujeme za zdravé a rozumné, považujeme uvažování určující jejich volbu cílů za nesmyslné a prostředky, které si k dosažení těchto cílů vybírají, za odporující sledo-vanému účelu.\n\nTermín „nevědomý“, tak jak jej používá praxeologie, a termíny „podvědomý“ a „nevědomý“, jak je aplikuje psychoanalýza, náležejí do dvou odlišných systémů myšlení a výzkumu. Praxeologie stejně jako ostatní odvětví vědění vděčí psychoanalýze za mnohé. Tím důležitější je proto uvědomit si hranici, která praxeologii od psychoanalýzy odděluje.\n\nJednání nepředstavuje pouhé udávání preferencí. Člověk projevuje preference rovněž v situacích, v nichž jsou věci a události nevyhnutelné či se jako nevyhnutelné jeví. Člověk tak může preferovat slunce před deštěm a může si přát, aby slunce mraky rozehnalo. Ten, kdo si pouze přeje a doufá, nezasahuje aktivně do běhu událostí a vlastního osudu. Jednající člověk naproti tomu volí, určuje a pokouší se dosáhnout cíle. Ze dvou věcí, které nemůže mít současně, si vybírá jednu a vzdává se druhé. Jednání proto vždy zahrnuje braní i zřeknutí se.\n\nVyjádření přání a nadějí či oznámení plánovaného jednání může být jistou formou jednání, pokud samo směřuje k naplnění jistého účelu. Nesmí však být zaměňováno s jednáním, na které odkazuje. Není totožné s jednáním, které oznamuje, doporučuje nebo odmítá. Jednání je reálnou věcí. Počítá se celkové chování člověka, nikoli pouhé mluvení o plánovaných, avšak neu-skutečněných aktech. Na druhou stranu je třeba jednání jasně odlišit od vykonávání práce. Jednání znamená použití prostředků pro dosažení cílů.\n\nZpravidla je jedním z těchto prostředků lidská práce. Nemusí to tak ale být vždy. Za jistých specifických okolností postačí slovo. Ten, kdo vydává příkazy či zákazy, může jednat, aniž by konal práci. Mluvit či mlčet, smát se či zůstat vážný, to vše může být jednáním. Spotřebovávat a užívat si je jednáním stejně jako zdržet se dostupné spotřeby a zábavy.\n\nPraxeologie tedy nerozlišuje mezi „aktivním“ či energickým a „pasivním“či netečným člověkem. Rázný člověk, pilně se snažící zlepšit své vlastní podmínky, nejedná ani více, ani méně než člověk letargický, který odevzdaně přijímá věci tak, jak na něj dopadají. Nedělat nic a být nečinný je totiž také jednání, i ono určuje běh věcí. Kdekoli jsou přítomny podmínky pro lidský zásah, jedná člověk bez ohledu na to, zda zasáhne či nikoli. Ten, kdo snáší, co by mohl změnit, nejedná o nic méně než ten, kdo za účelem dosáhnout odlišného výsledku zasáhne. Jedná i člověk, který se zdrží ovlivňování působení fyziologických a instinktivních faktorů, které mohl ovlivnit. Jednat neznamená pouze něco dělat, ale i neudělat něco, co uděláno být mohlo.\n\nMůžeme říci, že jednání je projevením lidské vůle. To by však k našemu poznání nic nepřidalo, neboť termín vůle neznamená nic jiného než schopnost člověka volit mezi různými stavy věcí, preferovat jednu věc, obětovat jinou a dále se chovat dle učiněného rozhodnutí s cílem dosáhnout zvoleného stavu a vzdát se stavů ostatních.\n\nPředpoklady lidského jednání\n\nSpokojeností či uspokojením nazýváme takový stav lidské bytosti, který nevede a nemůže vést k jednání. Jednající člověk chce nahradit méně uspokojivý stav věcí stavem uspokojivějším. Jeho mysl si představuje podmínky, jež by mu vyhovovaly lépe, a jednání směruje k dosažení tohoto žádoucího stavu. Incentivem, který nutí člověka jednat, je vždy pociťovaná nespokojenost. Člověk dokonale spokojený se stavem svých věcí by neměl žádný incentiv něco měnit. Neměl by ani přání, ani touhy; byl by dokonale spokojený. Nejednal by; jednoduše by žil, aniž by se o cokoli staral.\n\nNespokojenost a vidina uspokojivějšího stavu však samy o sobě nestačí k tomu, aby člověk jednal. Je třeba ještě třetí podmínky: očekávání, že má účelové chování moc odstranit či alespoň zmírnit pociťovanou nespokojenost.\n\nBez této podmínky není žádné jednání myslitelné. Člověk se musí podřídit nevyhnutelnému, podrobit se osudu.\n\nToto jsou tedy obecné podmínky lidského jednání, podmínky, za kterých člověk žije. Není pouze homo sapiens, ale také homo agens. Potomci člověka, kteří jsou ať již v důsledku vrozených či získaných postižení neodstranitelně neschopni jakéhokoli jednání, nejsou (v přísném smyslu toho termínu, nikoli pouze ve smyslu právním) ve skutečnosti lidmi. Ačkoli je zákony a biologie považují za lidi, postrádají základní vlastnost lidství. Ani nově narozené dítě není jednající bytostí. Ještě neurazilo celou cestu od početí k plnému rozvoji svých lidských kvalit. Na konci tohoto vývoje se však lidskou bytostí stane.\n\nO štěstí\n\nV běžné řeči říkáme o člověku, že je šťastný, pokud se mu podaří dosáhnout svých cílů. Přesněji bychom jeho stav měli popsat tak, že je šťastnější, než byl předtím. Proti zvyku, který definuje lidské jednání jako snahu o dosažení štěstí, však neexistuje žádná platná námitka.\n\nMusíme se nicméně vyhnout běžným nedorozuměním. Konečným cílem lidského jednání je vždy uspokojení přání jednajícího. Mimo individuálních hodnotových soudů, které se liší člověk od člověka i u jednoho člověka v různém čase, neexistuje žádný standard většího či menšího uspokojení. Člověk si určuje sám, dle standardů vlastní vůle a soudů, svým vlastním subjektivním hodnocením, co jej činí nespokojeným a méně nespokojeným. Nikdo není v pozici, aby mohl určit, co udělá člověka šťastnějším.\n\nUvedené skutečnosti se nijak nevztahují k antitezím egoismu a altruismu, materialismu a idealismu, individualismu a kolektivismu, ateismu a náboženství. Existují lidé, jejichž jediným cílem je zlepšit podmínky svého vlastního ega. Jiným lidem naopak vědomí utrpení jejich druhů způsobuje neméně či dokonce ještě více nespokojenosti než potřeby jejich vlastní. Někteří lidé si nepřejí nic jiného než uspokojení svých chutí po sexuálních vztazích, jídle, pití, dobrém bydlení a dalších hmotných věcech. Jiní lidé se však více starají o uspokojení potřeb, kterým obvykle říkáme „vyšší“ či „duchovní“. Někteří touží přizpůsobit své jednání požadavkům společenské spolupráce; na druhé straně existují vzpurní lidé, kteří jakýmkoli pravidlům společenského života vzdorují. Pro některé lidi je konečným cílem pozemské pouti příprava na život v blaženosti. Někteří lidé nevěří v učení žádného z náboženství a nedovolují, aby jejich život ovlivňovalo.\n\nPraxeologie je vůči konečným cílům jednání indiferentní. Její závěry jsou platné pro všechny typy jednání bez ohledu na to, k jakým cílům směřují. Je vědou o prostředcích, nikoli o cílech. Termín štěstí používá v čistě formálním smyslu. V praxeologické terminologii je věta: „Jediným cílem člověka je dosáhnout štěstí“ tautologická. Neříká nic o stavu věcí, od něhož člověk štěstí očekává.\n\nMyšlenka, že incentivem lidské aktivity je vždy nějaká nespokojenost a jejím cílem maximální možné odstranění této nespokojenosti, tedy obšťast-nění člověka, je podstatou učení eudaimonismu a hédonismu. Epikurejské ataraxia  je stavem dokonalého štěstí a uspokojení, k němuž směřuje veškeré lidské jednání, aniž by jej mohlo kdy plně dosáhnout. Vzhledem k velikosti této myšlenky je jen zcela nepodstatné, že mnozí zástupci této filozofie nerozpoznali čistě formální charakter strasti a radosti a přiřazovali jim materiální a tělesný význam. Teologické, mystické a další školy heteronomní etiky jádrem epikurejství neotřásly, neboť vůči němu nebyly schopny vznést žádnou jinou námitku, než že opomíjí „vyšší“ a „ctnostnější“ radosti. Je pravda, že mnohé z raných prací zastánců epikurejství, eudaimonismu, hédonismu a utilitarismu jsou v některých aspektech náchylné k dezinterpretacím. Jazyk moderních filozofů a ještě více moderních ekonomů je ale tak přesný a jednoznačný, že k žádné dezinterpretaci dojít nemůže.\n\nO instinktech a pudech\n\nPorozumění základním problémům lidského jednání nelze nijak posunout metodami instinktivní sociologie. Tato škola klasifikuje různé konkrétní cíle lidského jednání a každé třídě přisuzuje jako její motiv nějaký instinkt. Člověk se jeví jako bytost poháněná různými vrozenými instinkty a tempera-menty. Má se za to, že toto vysvětlení jednou provždy vyvrací odporné učení ekonomie a utilitární etiky. Avšak již Feuerbach správně ukázal, že každý instinkt je instinktem ke štěstí. Metoda instinktivní psychologie a instinktivní sociologie spočívá v arbitrární klasifikaci bezprostředních cílů jednání a v jejich zvěcnění. Zatímco praxeologie říká, že cílem jednání je odstranění jisté nespokojenosti, instinktivní psychologie tvrdí, že je jím uspokojení instinktivního pudu.\n\nMnozí zastánci instinktivní školy jsou přesvědčeni, že dokázali, že jednání není určováno rozumem, nýbrž vyplývá z hlubin vrozených sil, pudů, instinktů a dispozic, které nelze nijak racionálně osvětlit. Jsou si naprosto jisti svým úspěchem při odhalování plytkosti racionalismu a při znevažování ekonomie coby „souboru mylných vývodů, založeném na chybných psychologických předpokladech“. Racionalismus, praxeologie a ekonomie však nepojednáva-jí o konečných zdrojích a cílech jednání. Zabývají se použitím prostředků k dosažení sledovaných cílů. Jakkoli neuchopitelná může být hloubka, v níž pudy a instinkty vznikají, prostředky, které člověk volí pro jejich uspokojení, jsou určovány racionálním zvážením nákladů a úspěchu.\n\nTen, kdo jedná na základě emocionálních pudů, také jedná. Od ostatních typů jednání se emocionální jednání odlišuje jiným hodnocením vstupů a výstupů. Emoce narušují hodnocení. Člověk rozvášněný emocemi považuje cíle za daleko více žádoucí a cenu, kterou musí zaplatit, za nižší, než kdyby měl chladnou hlavu. Lidé nikdy nepochybovali, že dokonce i v emocionálně vypjatém stavu zvažují prostředky a cíle a že je možné ovlivnit výsledek tohoto rozhodování tím, že se zvýší náklady podlehnutí pudům vášně. Trestat mír-něji trestné činy spáchané ve stavu emocionálního vzrušení či pod vlivem drog znamená tyto excesy podporovat. Není pravda, že hrozba přísného potrestání neodradí lidi vedené zdánlivě nepřemožitelnou vášní.\n\nChování zvířat interpretujeme na základě předpokladu, že zvířata podléhají momentálním pudům. Když pozorujeme, jak se zvířata živí, mají potom-stvo a napadají ostatní zvířata či lidi, hovoříme o potravním instinktu, repro-dukčním instinktu či instinktu k agresivitě. Předpokládáme, že jsou vrozené a vytrvale žádají své uspokojení.\n\nS lidmi je to ale jinak. Člověk není bytostí, která by se nedokázala vzepřít instinktům, jež nejnaléhavěji volají po svém uspokojení. Člověk dokáže emoce a pudy potlačit. Dokáže racionalizovat své chování. Zřekne se uspokojení nutkavého pudu, jen aby uspokojil ostatní přání. Není loutkou v rukou svých choutek. Muž se nevrhá na každou ženu, která zjitří jeho smysly, nezhltne každý kousek jídla, který jej zláká, nesrazí každého člověka, kterého by si přál zabít. Svá přání a tužby uspořádává do škály, volí, či krátce řečeno, jedná. Právě to, že člověk vědomě uspořádává své chování, jej odlišuje od zvířat. Člověk je bytostí se zábranami, která ovládá své pudy a touhy, která má moc instinktivní přání a pudy potlačit.\n\nMůže se stát, že se pud objeví s takovou naléhavostí, že žádná nevýhoda, kterou by jeho uspokojení mohlo přinést, se nezdá natolik velká, aby zabránila jeho naplnění. I zde se objevuje volba. Člověk se rozhoduje pro podlehnutí danému přání.\n\nLidské jednání jako konečná danost\n\nČlověk od nepaměti toužil poznat prvotního hybatele, příčinu všech věcí a všech změn, poslední substanci, z níž vše povstává a která je příčinou sebe sama. Věda je skromnější. Je si vědoma omezení lidské mysli a lidské snahy poznávat. Jejím cílem je vystopovat všechny jevy k jejich příčinám. Chápe však, že tato snaha musí nutně narazit na nepřekonatelné překážky. Jsou jevy, které nelze analyzovat a vysvětlit pomocí jiných jevů. Jsou konečnou daností. Pokrok vědeckého zkoumání může odhalit, že něco, dříve považované za konečnou danost, lze rozložit na další součásti. Vždy však bude existovat nějaký neredukovatelný a dále neanalyzovatelný jev, nějaká konečná danost.\n\n</ideal_output>\n</example>\n<example>\n<CZECH_TEXT>\n\nSlužba, kterou buržoazní ekonomie prokazovala buržoazii, byla v Marxových očích dvojí. Pomáhala jí v jejím boji proti feudalismu a královskému despotismu a později znovu v boji proti rodícímu se proletariátu. Poskytovala morální a racionální ospravedlnění kapitalistického vykořisťování. Byla, chceme-li použít pojem, který vznikl po Marxově smrti, racionálním odůvod-6 Srov. Lancelot Hogben, Science for the Citizen (New York, 1938), str. 726—728.\n\n7 Ibid.,  str. 726.\n\n70\n\n01_Lidske jednani_final.qxd 5.5.2006 16:01 StrÆnka 71\n\nňováním nároků kapitalistů.8 Kapitalisté, zahanbeni ve svém podvědomí mrzkými chamtivými motivacemi vlastního chování a toužící po tom, vyhnout se společenskému zatracení, povzbuzují své pochlebovače ekonomy k hlásání doktrín, které by je v očích veřejnosti rehabilitovali.\n</CZECH_TEXT>\n<ideal_output>\nSlužba, kterou buržoazní ekonomie prokazovala buržoazii, byla v Marxových očích dvojí. Pomáhala jí v jejím boji proti feudalismu a královskému despotismu a později znovu v boji proti rodícímu se proletariátu. Poskytovala morální a racionální ospravedlnění kapitalistického vykořisťování. Byla, chceme-li použít pojem, který vznikl po Marxově smrti, racionálním odůvodňováním nároků kapitalistů. Kapitalisté, zahanbeni ve svém podvědomí mrzkými chamtivými motivacemi vlastního chování a toužící po tom, vyhnout se společenskému zatracení, povzbuzují své pochlebovače ekonomy k hlásání doktrín, které by je v očích veřejnosti rehabilitovali.\n</ideal_output>\n</example>\n<example>\n<CZECH_TEXT>\n\n65\n\n01_Lidske jednani_final.qxd 5.5.2006 16:01 StrÆnka 66\n\nPlánoval nahradit křesťanství novým náboženstvím a zvolil dámu, která byla v této nové církvi určena jako náhrada za Pannu Marii. Comta lze omluvit, neboť byl duševně chorý v plném smyslu slova, který mu přisuzuje patologie.\n\nCo však jeho následovníci?\n\nBylo by možné zmínit se o mnoha dalších podobných faktech. Nepředstavují však žádný argument proti rozumu, racionalismu a racionalitě. Tyto sny nemají vůbec nic společného s otázkou, zda je rozum správným a jediným nástrojem, kterým člověk disponuje ve své snaze dosáhnout co největšího možného poznání. Čestní a svědomití hledači pravdy nikdy nepředstírají, že rozum a vědecký výzkum mohou poskytnout odpovědi na všechny otázky.\n\nJsou si omezení lidské mysli plně vědomi. Nelze je činit zodpovědné za hru-bosti Hegelovy filozofie a simplifikace různých materiálních škol.\n\nSami racionalističtí filozofové se vždy zaměřovali na odhalení hranic apriorní teorie i empirického výzkumu.1 První zástupce britské politické ekonomie, David Hume, utilitarista, a američtí pragmatisté jistě nejsou vinni tím, že by přeháněli moc člověka dosáhnout pravdy. Spíše by šlo filozofii uplynulých dvou set let obvinit z přílišného agnosticismu a skepticismu než z přehnané důvěry v to, čeho může lidský rozum dosáhnout.\n\nRevolta proti rozumu, charakteristický mentální postoj naší doby, nebyla způsobena nedostatkem skromnosti, opatrnosti a sebezpytování na straně filozofů. Ani není důsledkem evoluce moderní přírodní vědy. Úžasné úspěchy technologie a terapeutiky mluví jazykem, který nikdo nemůže ignorovat.\n\nÚtočit na moderní vědu, ať již z pozice intuicionismu či mysticismu či z jakéhokoli jiného pohledu, je beznadějné. Revolta proti rozumu směřovala na jiný cíl. Nemířila na přírodní vědy, ale na ekonomii. Útok proti přírodním vědám byl jen logicky nutným výsledkem útoku proti ekonomii. Bylo nemožné sesa-dit rozum pouze v jedné oblasti a nezpochybnit jej současně i v ostatních odvětvích poznání.\n\nToto velké povstání se zrodilo v historické situaci, která existovala v polovině devatenáctého století. Ekonomové zcela zničili fantastické přeludy socialistických utopistů. Nedostatky klasického systému jim sice zabránily pochopit, proč nelze žádný socialistický plán uskutečnit. Věděli však dost na to, aby prokázali marnost všech socialistických schémat vytvořených do jejich doby. Komunistické myšlenky byly vyřízené. Socialisté absolutně nedokázali vznést jakékoli námitky vůči devastující kritice svých schémat a nalézt ve svůj prospěch nějaký argument. Zdálo se, že je socialismus navždy mrtev.\n\nJen jedna cesta mohla socialisty z této slepé uličky vyvést. Mohli zaútočit na logiku a rozum a nahradit usuzování mystickou intuicí. Navrhnout toto řešení bylo historickou úlohou Karla Marxe. Na základě Hegelova dialektic-1 Srov. např. Louis Rougier, Les Paralogismes du rationalisme (Paříž, 1920).\n\n66\n\n01_Lidske jednani_final.qxd 5.5.2006 16:01 StrÆnka 67\n\nkého mysticismu si lehkovážně přisoudil schopnost předpovídat budoucnost.\n\nHegel předstíral, že ví, že Geist  při vytvoření světa chtěl dát vzniknout monar-chii Bedřicha Viléma III. Marx byl však o jeho plánech informován lépe.\n\nVěděl, že konečným cílem historického vývoje bylo ustanovení socialistického milénia. Socialismus musí přijít „s nevyhnutelností přírodního zákona“.\n\nA jelikož je podle Hegela každé další stadium historie vyšším a lepším stadiem, nelze pochybovat o tom, že socialismus, konečné a nejvyšší stadium vývoje lidstva, bude ve všech ohledech dokonalý. V důsledku toho je zbytečné diskutovat o detailech fungování socialistického společenství. Historie v pravý čas vše nejlépe uspořádá. Nepotřebuje k tomu rady smrtelných lidí.\n\nStále ještě zůstávala nepřekonaná hlavní překážka: devastující kritika ze strany ekonomů. Marx měl po ruce řešení. Tvrdil, že je lidský rozum ze své podstaty k hledání pravdy nevhodný. Logická struktura mysli se mezi různými společenskými třídami liší. Neexistuje nic jako univerzálně platná logika.\n\nMysl neprodukuje nic jiného než „ideologii“, ta je v Marxově terminologii soubor myšlenek maskující sobecké zájmy myslitelovy vlastní společenské třídy. Proto „buržoazní“ mysl ekonomů nedokáže vytvořit více než jen apolo-gie kapitalismu. Učení „buržoazní“ vědy, výplodu „buržoazní“ logiky, je zby-tečností pro proletáře, povstávající třídu určenou k odstranění všech tříd a převedení země do rajské zahrady.\n\nLogika proletářů však samozřejmě není jen třídní logikou. „Myšlenky proletářské logiky nejsou stranickými myšlenkami, nýbrž emanací čisté a prosté logiky.“2 Díky zvláštnímu privilegiu není navíc ani logika některých vyvolených buržoů znečištěna prvotním hříchem náležitosti k buržoazii. Karel Marx, syn úspěšného právníka, zeť pruského šlechtice, a jeho spolupracovník Bedřich Engels, bohatý textilní továrník, nikdy nepochybovali o tom, že oni sami jsou nad zákonem a nehledě na svůj buržoazní původ jsou nadáni mocí odhalovat absolutní pravdu.\n\nJe úkolem historie popsat historické podmínky, které tyto primitivní doktríny zpopularizovaly. Ekonomie má jiný úkol. Musí analyzovat Marxův polylogismus i další polylogismy vzniklé podle jeho vzoru a ukázat jejich omyly a rozpory.\n\n2. Logické aspekty polylogismu\n\nMarxistický polylogismus tvrdí, že se logická struktura mysli liší mezi příslušníky různých společenských tříd. Rasový polylogismus se od marxistického odlišuje pouze v tom, že zvláštní logickou strukturu přisuzuje každé 2 Srov. Joseph Dietzgen, Briefe über Logik, speziell demokratisch-proletarische Logik (2. vyd., Stuttgart, 1903), str. 112.\n\n</CZECH_TEXT>\n<ideal_output>\nPlánoval nahradit křesťanství novým náboženstvím a zvolil dámu, která byla v této nové církvi určena jako náhrada za Pannu Marii. Comta lze omluvit, neboť byl duševně chorý v plném smyslu slova, který mu přisuzuje patologie.\n\nCo však jeho následovníci?\n\nBylo by možné zmínit se o mnoha dalších podobných faktech. Nepředstavují však žádný argument proti rozumu, racionalismu a racionalitě. Tyto sny nemají vůbec nic společného s otázkou, zda je rozum správným a jediným nástrojem, kterým člověk disponuje ve své snaze dosáhnout co největšího možného poznání. Čestní a svědomití hledači pravdy nikdy nepředstírali, že rozum a vědecký výzkum mohou poskytnout odpovědi na všechny otázky.\n\nJsou si omezení lidské mysli plně vědomi. Nelze je činit zodpovědné za hrubosti Hegelovy filozofie a simplifikace různých materiálních škol.\n\nSami racionalističtí filozofové se vždy zaměřovali na odhalení hranic apriorní teorie i empirického výzkumu. První zástupce britské politické ekonomie, David Hume, utilitarista, a američtí pragmatisté jistě nejsou vinni tím, že by přeháněli moc člověka dosáhnout pravdy. Spíše by šlo filozofii uplynulých dvou set let obvinit z přílišného agnosticismu a skepticismu než z přehnané důvěry v to, čeho může lidský rozum dosáhnout.\n\nRevolta proti rozumu, charakteristický mentální postoj naší doby, nebyla způsobena nedostatkem skromnosti, opatrnosti a sebezpytování na straně filozofů. Ani není důsledkem evoluce moderní přírodní vědy. Úžasné úspěchy technologie a terapeutiky mluví jazykem, který nikdo nemůže ignorovat.\n\nÚtočit na moderní vědu, ať již z pozice intuicionismu či mysticismu či z jakéhokoli jiného pohledu, je beznadějné. Revolta proti rozumu směřovala na jiný cíl. Nemířila na přírodní vědy, ale na ekonomii. Útok proti přírodním vědám byl jen logicky nutným výsledkem útoku proti ekonomii. Bylo nemožné sesadit rozum pouze v jedné oblasti a nezpochybnit jej současně i v ostatních odvětvích poznání.\n\nToto velké povstání se zrodilo v historické situaci, která existovala v polovině devatenáctého století. Ekonomové zcela zničili fantastické přeludy socialistických utopistů. Nedostatky klasického systému jim sice zabránily pochopit, proč nelze žádný socialistický plán uskutečnit. Věděli však dost na to, aby prokázali marnost všech socialistických schémat vytvořených do jejich doby. Komunistické myšlenky byly vyřízené. Socialisté absolutně nedokázali vznést jakékoli námitky vůči devastující kritice svých schémat a nalézt ve svůj prospěch nějaký argument. Zdálo se, že je socialismus navždy mrtev.\n\nJen jedna cesta mohla socialisty z této slepé uličky vyvést. Mohli zaútočit na logiku a rozum a nahradit usuzování mystickou intuicí. Navrhnout toto řešení bylo historickou úlohou Karla Marxe. Na základě Hegelova dialektického mysticismu si lehkovážně přisoudil schopnost předpovídat budoucnost.\n\nHegel předstíral, že ví, že Geist při vytvoření světa chtěl dát vzniknout monarchii Bedřicha Viléma třetího. Marx byl však o jeho plánech informován lépe. Věděl, že konečným cílem historického vývoje bylo ustanovení socialistického milénia. Socialismus musí přijít s nevyhnutelností přírodního zákona.\n\nA jelikož je podle Hegela každé další stadium historie vyšším a lepším stadiem, nelze pochybovat o tom, že socialismus, konečné a nejvyšší stadium vývoje lidstva, bude ve všech ohledech dokonalý. V důsledku toho je zbytečné diskutovat o detailech fungování socialistického společenství. Historie v pravý čas vše nejlépe uspořádá. Nepotřebuje k tomu rady smrtelných lidí.\n\nStále ještě zůstávala nepřekonaná hlavní překážka: devastující kritika ze strany ekonomů. Marx měl po ruce řešení. Tvrdil, že je lidský rozum ze své podstaty k hledání pravdy nevhodný. Logická struktura mysli se mezi různými společenskými třídami liší. Neexistuje nic jako univerzálně platná logika.\n\nMysl neprodukuje nic jiného než ideologii, ta je v Marxově terminologii soubor myšlenek maskující sobecké zájmy myslitelovy vlastní společenské třídy. Proto buržoazní mysl ekonomů nedokáže vytvořit více než jen apologii kapitalismu. Učení buržoazní vědy, výplodu buržoazní logiky, je zbytečností pro proletáře, povstávající třídu určenou k odstranění všech tříd a převedení země do rajské zahrady.\n\nLogika proletářů však samozřejmě není jen třídní logikou. Myšlenky proletářské logiky nejsou stranickými myšlenkami, nýbrž emanací čisté a prosté logiky. Díky zvláštnímu privilegiu není navíc ani logika některých vyvolených buržoů znečištěna prvotním hříchem náležitosti k buržoazii. Karel Marx, syn úspěšného právníka, zeť pruského šlechtice, a jeho spolupracovník Bedřich Engels, bohatý textilní továrník, nikdy nepochybovali o tom, že oni sami jsou nad zákonem a nehledě na svůj buržoazní původ jsou nadáni mocí odhalovat absolutní pravdu.\n\nJe úkolem historie popsat historické podmínky, které tyto primitivní doktríny zpopularizovaly. Ekonomie má jiný úkol. Musí analyzovat Marxův polylogismus i další polylogismy vzniklé podle jeho vzoru a ukázat jejich omyly a rozpory.\n\nMarxistický polylogismus tvrdí, že se logická struktura mysli liší mezi příslušníky různých společenských tříd. Rasový polylogismus se od marxistického odlišuje pouze v tom, že zvláštní logickou strukturu přisuzuje každé rase.\n</ideal_output>\n</example>\n<example>\n<CZECH_TEXT>\n01_Lidske jednani_final.qxd 5.5.2006 16:01 StrÆnka 48\n</CZECH_TEXT>\n<ideal_output>\n\n\n</ideal_output>\n</example>\n<example>\n<CZECH_TEXT>\nNesoulad mezi historiky v těchto otázkách neplyne z jejich pozice coby historiků, ale z používání nehistorických věd na předmět historie. Nesouhlasí stejně, jako agnostický lékař nesouhlasí ve věci zázraků v Lourdech s lékařskou komisí pro sběr a evidenci těchto zázraků. Pouze ti, kdo věří, že fakta píší své vlastní příběhy na čistý list lidské mysli, historiky za tyto odlišné 48\n</CZECH_TEXT>\n<ideal_output>\nNesoulad mezi historiky v těchto otázkách neplyne z jejich pozice coby historiků, ale z používání nehistorických věd na předmět historie. Nesouhlasí stejně, jako agnostický lékař nesouhlasí ve věci zázraků v Lourdech s lékařskou komisí pro sběr a evidenci těchto zázraků. Pouze ti, kdo věří, že fakta píší své vlastní příběhy na čistý list lidské mysli, historiky za tyto odlišné \n</ideal_output>\n</example>\n<example>\n<CZECH_TEXT>\nnázory obviňují. Neuvědomují si, že historie nikdy nemůže pracovat bez předpokladů a že rozdílnosti v předpokladech, což znamená v celém obsahu nehistorického poznání, určují stanovení historických faktů.\n</CZECH_TEXT>\n<ideal_output>\nnázory obviňují. Neuvědomují si, že historie nikdy nemůže pracovat bez předpokladů a že rozdílnosti v předpokladech, což znamená v celém obsahu nehistorického poznání, určují stanovení historických faktů.\n</ideal_output>\n</example>\n<example>\n<CZECH_TEXT>\n50\n\n</CZECH_TEXT>\n<ideal_output>\n\n\n</ideal_output>\n</example>\n</examples>\n\n"
                                },
                                {
                                    "type": "text",
                                    "text": f"Modify the given text to make it optimal for reading aloud. Here is the text you need to work on:\n\n<input_text>\n{content}\n</input_text>\n\nRemember to focus solely on improving the text for voice synthesis without adding any additional content or explanations."
                                }
                            ]
                        }]
                    )
                )
                requests.append(request)
        
        return requests

    async def process_batch_results(self, batch_id: str, files_to_process: list[str]) -> None:
        """Processes batch results and writes optimized content."""
        try:
            pbar = tqdm(total=len(files_to_process), desc="Processing files")
            processed_files = set()
            retry_interval = 5  # seconds between status checks

            while len(processed_files) < len(files_to_process):
                # Check batch processing status
                message_batch = self.client.messages.batches.retrieve(batch_id)
                logging.info(f"Batch {message_batch.id} processing status is {message_batch.processing_status}")
                
                # If still processing, wait before checking again
                if message_batch.processing_status == "in_progress":
                    await asyncio.sleep(retry_interval)
                    continue
                
                # Once batch processing has ended, process results
                if message_batch.processing_status == "ended":
                    for result in self.client.messages.batches.results(batch_id):
                        if result.custom_id in processed_files:
                            continue
                            
                        match result.result.type:
                            case "succeeded":
                                # Get original filename from the mapping
                                filename = self.custom_id_to_filename[result.custom_id]
                                file_path = self.base_dir / filename
                                logging.info(f"Processing successful result for {result.custom_id} ({filename})")
                                
                                self.write_optimized_content(
                                    file_path, 
                                    result.result.message.content[0].text
                                )
                                processed_files.add(result.custom_id)
                                pbar.update(1)
                                
                            case "errored":
                                filename = self.custom_id_to_filename[result.custom_id]
                                if result.result.error.type == "invalid_request":
                                    # Request body must be fixed before re-sending request
                                    logging.error(f"Validation error for request {result.custom_id} ({filename})")
                                else:
                                    # Request can be retried directly
                                    logging.error(f"Server error for request {result.custom_id} ({filename})")
                                processed_files.add(result.custom_id)
                                pbar.update(1)
                                
                            case "expired":
                                filename = self.custom_id_to_filename[result.custom_id]
                                logging.error(f"Request expired for {result.custom_id} ({filename})")
                                processed_files.add(result.custom_id)
                                pbar.update(1)
                                
                    break  # Exit loop once we've processed all results
                else:
                    logging.error(f"Unexpected processing status: {message_batch.processing_status}")
                    break

            pbar.close()

        except Exception as e:
            logging.error(f"Error in batch processing: {e}")
            raise


    async def process_files(self, files_to_process: list[str]) -> None:
        """Processes files using the Message Batches API."""
        try:
            # Prepare batch requests
            requests = self.prepare_batch_requests(files_to_process)
            
            if not requests:
                logging.error("No valid files to process")
                return

            # Create batch request
            logging.info("Submitting batch request...")
            message_batch = self.client.messages.batches.create(requests=requests)
            
            # Monitor batch processing status
            logging.info(f"Batch ID: {message_batch.id}")
            logging.info("Processing batch results...")
            
            # Process results
            await self.process_batch_results(message_batch.id, files_to_process)
            
            logging.info("Batch processing completed")

        except Exception as e:
            logging.error(f"Error in batch processing: {e}")

async def main():
    # Initialize the processor
    processor = BatchProcessor(
        api_key=os.environ.get("ANTHROPIC_API_KEY"),
        base_dir='/home/sparrow/projects/eleven-audiobooks/data/processed/splitted'
    )
    
    # Specific files to process
    files_to_process = [
        'chapter_30a.md', 'chapter_30b.md', 'chapter_30c.md', 'chapter_30d.md', 'chapter_30e.md', 'chapter_30f.md', 'chapter_31a.md', 'chapter_31b.md', 'chapter_32a.md', 'chapter_32b.md', 'chapter_32c.md', 'chapter_32d.md', 'chapter_32e.md', 'chapter_32f.md', 'chapter_33a.md', 'chapter_34a.md', 'chapter_35a.md', 'chapter_35b.md', 'chapter_35c.md', 'chapter_35d.md', 'chapter_35e.md', 'chapter_35f.md', 'chapter_35g.md', 'chapter_35h.md', 'chapter_35i.md', 'chapter_35j.md', 'chapter_36a.md', 'chapter_36b.md', 'chapter_36c.md', 'chapter_36d.md', 'chapter_37a.md', 'chapter_37b.md', 'chapter_37c.md', 'chapter_37d.md', 'chapter_37e.md', 'chapter_37f.md', 'chapter_37g.md', 'chapter_38a.md', 'chapter_38b.md', 'chapter_38c.md', 'chapter_38d.md', 'chapter_38e.md', 'chapter_38f.md', 'chapter_38g.md', 'chapter_38h.md', 'chapter_38i.md', 'chapter_39a.md', 'chapter_39b.md', 'chapter_40a.md', 'chapter_41a.md', 'chapter_41b.md', 'chapter_42a.md', 'chapter_42b.md', 'chapter_42c.md', 'chapter_42d.md', 'chapter_42e.md', 'chapter_42f.md', 'chapter_42g.md', 'chapter_42h.md', 'chapter_42i.md', 'chapter_42j.md', 'chapter_42k.md', 'chapter_42l.md', 'chapter_42m.md', 'chapter_42n.md', 'chapter_43a.md', 'chapter_43b.md', 'chapter_44a.md', 'chapter_44b.md', 'chapter_44c.md', 'chapter_45a.md', 'chapter_46a.md', 'chapter_47a.md', 'chapter_47b.md', 'chapter_47c.md', 'chapter_47d.md', 'chapter_47e.md', 'chapter_47f.md', 'chapter_48a.md', 'chapter_48b.md', 'chapter_48c.md', 'chapter_48d.md', 'chapter_48e.md', 'chapter_48f.md', 'chapter_49a.md', 'chapter_49b.md', 'chapter_50a.md', 'chapter_50b.md', 'chapter_50c.md', 'chapter_51a.md', 'chapter_52a.md', 'chapter_53a.md', 'chapter_54a.md', 'chapter_54b.md', 'chapter_55a.md', 'chapter_55b.md', 'chapter_55c.md', 'chapter_56a.md', 'chapter_56b.md', 'chapter_56c.md', 'chapter_57a.md', 'chapter_57b.md', 'chapter_57c.md', 'chapter_57d.md', 'chapter_57e.md', 'chapter_58a.md', 'chapter_58b.md', 'chapter_58c.md', 'chapter_59a.md', 'chapter_59b.md', 'chapter_60a.md', 'chapter_60b.md', 'chapter_60c.md', 'chapter_60d.md', 'chapter_60e.md', 'chapter_60f.md', 'chapter_60g.md', 'chapter_60h.md', 'chapter_61a.md', 'chapter_61b.md', 'chapter_62a.md', 'chapter_62b.md', 'chapter_62c.md', 'chapter_62d.md', 'chapter_62e.md', 'chapter_62f.md', 'chapter_62g.md', 'chapter_62h.md', 'chapter_62i.md', 'chapter_62j.md', 'chapter_62k.md', 'chapter_62l.md', 'chapter_62m.md', 'chapter_62n.md', 'chapter_62o.md', 'chapter_62p.md', 'chapter_62q.md', 'chapter_62r.md', 'chapter_63a.md', 'chapter_63b.md', 'chapter_63c.md', 'chapter_63d.md', 'chapter_63e.md', 'chapter_63f.md', 'chapter_63g.md', 'chapter_64a.md', 'chapter_65a.md', 'chapter_65b.md', 'chapter_66a.md', 'chapter_67a.md', 'chapter_67b.md', 'chapter_67c.md', 'chapter_67d.md', 'chapter_67e.md', 'chapter_67f.md', 'chapter_68a.md', 'chapter_69a.md', 'chapter_69b.md', 'chapter_69c.md', 'chapter_69d.md', 'chapter_69e.md', 'chapter_69f.md', 'chapter_70a.md', 'chapter_71a.md', 'chapter_72a.md', 'chapter_72b.md', 'chapter_72c.md', 'chapter_72d.md', 'chapter_72e.md', 'chapter_73a.md', 'chapter_74a.md', 'chapter_74b.md', 'chapter_75a.md', 'chapter_75b.md', 'chapter_76a.md', 'chapter_76b.md', 'chapter_77a.md', 'chapter_78a.md', 'chapter_78b.md', 'chapter_78c.md', 'chapter_78d.md', 'chapter_78e.md', 'chapter_79a.md', 'chapter_79b.md', 'chapter_79c.md', 'chapter_79d.md', 'chapter_79e.md', 'chapter_79f.md', 'chapter_79g.md', 'chapter_79h.md', 'chapter_80a.md', 'chapter_80b.md', 'chapter_81a.md', 'chapter_81b.md', 'chapter_81c.md', 'chapter_81d.md', 'chapter_82a.md', 'chapter_82b.md', 'chapter_82c.md', 'chapter_82d.md', 'chapter_83a.md', 'chapter_83b.md', 'chapter_83c.md', 'chapter_83d.md', 'chapter_83e.md', 'chapter_83f.md', 'chapter_83g.md', 'chapter_84a.md', 'chapter_84b.md', 'chapter_85a.md', 'chapter_85b.md', 'chapter_86a.md', 'chapter_86b.md', 'chapter_86c.md', 'chapter_86d.md', 'chapter_86e.md', 'chapter_86f.md', 'chapter_87a.md', 'chapter_87b.md', 'chapter_87c.md', 'chapter_87d.md', 'chapter_87e.md', 'chapter_87f.md', 'chapter_88a.md', 'chapter_89a.md', 'chapter_89b.md', 'chapter_90a.md', 'chapter_90b.md', 'chapter_90c.md', 'chapter_90d.md', 'chapter_91a.md', 'chapter_92a.md', 'chapter_92b.md', 'chapter_93a.md', 'chapter_93b.md', 'chapter_93c.md', 'chapter_93d.md', 'chapter_93e.md', 'chapter_93f.md', 'chapter_93g.md', 'chapter_93h.md', 'chapter_94a.md', 'chapter_94b.md', 'chapter_94c.md', 'chapter_95a.md', 'chapter_95b.md', 'chapter_95c.md', 'chapter_95d.md', 'chapter_95e.md', 'chapter_95f.md', 'chapter_95g.md', 'chapter_95h.md', 'chapter_96a.md', 'chapter_96b.md', 'chapter_96c.md', 'chapter_97a.md', 'chapter_98a.md', 'chapter_99a.md', 'chapter_99b.md', 'chapter_99c.md', 'chapter_100a.md', 'chapter_100b.md', 'chapter_100c.md', 'chapter_100d.md', 'chapter_100e.md', 'chapter_100f.md', 'chapter_100g.md', 'chapter_101a.md', 'chapter_102a.md', 'chapter_102b.md', 'chapter_102c.md', 'chapter_103a.md', 'chapter_103b.md', 'chapter_103c.md', 'chapter_103d.md', 'chapter_103e.md', 'chapter_103f.md', 'chapter_103g.md', 'chapter_103h.md', 'chapter_104a.md', 'chapter_104b.md', 'chapter_104c.md', 'chapter_105a.md', 'chapter_105b.md', 'chapter_105c.md', 'chapter_106a.md', 'chapter_106b.md', 'chapter_107a.md', 'chapter_107b.md', 'chapter_108a.md', 'chapter_108b.md', 'chapter_108c.md', 'chapter_108d.md', 'chapter_108e.md', 'chapter_108f.md', 'chapter_108g.md', 'chapter_108h.md', 'chapter_109a.md', 'chapter_110a.md', 'chapter_111a.md', 'chapter_111b.md', 'chapter_111c.md', 'chapter_111d.md', 'chapter_112a.md', 'chapter_112b.md', 'chapter_112c.md', 'chapter_112d.md', 'chapter_113a.md', 'chapter_113b.md', 'chapter_113c.md', 'chapter_113d.md', 'chapter_113e.md', 'chapter_114a.md', 'chapter_114b.md', 'chapter_115a.md', 'chapter_115b.md', 'chapter_116a.md', 'chapter_116b.md', 'chapter_117a.md', 'chapter_118a.md', 'chapter_119a.md', 'chapter_119b.md', 'chapter_120a.md', 'chapter_121a.md', 'chapter_121b.md', 'chapter_122a.md', 'chapter_122b.md', 'chapter_123a.md', 'chapter_124a.md', 'chapter_125a.md', 'chapter_125b.md', 'chapter_125c.md', 'chapter_126a.md', 'chapter_126b.md', 'chapter_126c.md', 'chapter_127a.md', 'chapter_128a.md', 'chapter_128b.md', 'chapter_129a.md', 'chapter_129b.md', 'chapter_130a.md', 'chapter_131a.md', 'chapter_131b.md', 'chapter_131c.md', 'chapter_132a.md', 'chapter_133a.md', 'chapter_133b.md', 'chapter_133c.md', 'chapter_133d.md', 'chapter_134a.md', 'chapter_135a.md', 'chapter_136a.md', 'chapter_137a.md', 'chapter_137b.md', 'chapter_137c.md', 'chapter_137d.md', 'chapter_137e.md', 'chapter_138a.md', 'chapter_139a.md', 'chapter_139b.md', 'chapter_140a.md', 'chapter_140b.md', 'chapter_140c.md', 'chapter_140d.md', 'chapter_140e.md', 'chapter_140f.md', 'chapter_141a.md', 'chapter_141b.md', 'chapter_142a.md', 'chapter_142b.md', 'chapter_143a.md', 'chapter_143b.md', 'chapter_143c.md', 'chapter_144a.md', 'chapter_145a.md', 'chapter_145b.md', 'chapter_145c.md', 'chapter_145d.md', 'chapter_145e.md', 'chapter_145f.md', 'chapter_145g.md', 'chapter_145h.md', 'chapter_145i.md', 'chapter_145j.md', 'chapter_145k.md', 'chapter_146a.md', 'chapter_146b.md', 'chapter_147a.md', 'chapter_147b.md', 'chapter_147c.md', 'chapter_147d.md', 'chapter_147e.md', 'chapter_147f.md', 'chapter_148a.md', 'chapter_148b.md', 'chapter_149a.md', 'chapter_149b.md', 'chapter_150a.md', 'chapter_151a.md', 'chapter_151b.md', 'chapter_151c.md', 'chapter_152a.md', 'chapter_152b.md', 'chapter_152c.md', 'chapter_152d.md', 'chapter_153a.md', 'chapter_153b.md', 'chapter_153c.md', 'chapter_154a.md', 'chapter_154b.md', 'chapter_155a.md', 'chapter_155b.md', 'chapter_155c.md', 'chapter_155d.md', 'chapter_155e.md', 'chapter_155f.md', 'chapter_156a.md', 'chapter_156b.md', 'chapter_156c.md', 'chapter_156d.md', 'chapter_157a.md', 'chapter_158a.md', 'chapter_158b.md', 'chapter_159a.md', 'chapter_159b.md', 'chapter_159c.md', 'chapter_159d.md', 'chapter_160a.md', 'chapter_160b.md', 'chapter_161a.md', 'chapter_162a.md', 'chapter_162b.md', 'chapter_162c.md', 'chapter_163a.md', 'chapter_163b.md', 'chapter_164a.md', 'chapter_164b.md', 'chapter_164c.md', 'chapter_164d.md', 'chapter_164e.md', 'chapter_164f.md', 'chapter_165a.md', 'chapter_165b.md', 'chapter_165c.md', 'chapter_165d.md', 'chapter_165e.md', 'chapter_165f.md', 'chapter_165g.md', 'chapter_165h.md', 'chapter_165i.md', 'chapter_165j.md', 'chapter_165k.md', 'chapter_166a.md', 'chapter_166b.md', 'chapter_166c.md', 'chapter_167a.md', 'chapter_167b.md', 'chapter_167c.md', 'chapter_168a.md', 'chapter_168b.md', 'chapter_168c.md', 'chapter_168d.md', 'chapter_169a.md', 'chapter_169b.md', 'chapter_169c.md', 'chapter_169d.md', 'chapter_169e.md', 'chapter_169f.md', 'chapter_169g.md', 'chapter_169h.md', 'chapter_169i.md', 'chapter_169j.md', 'chapter_170a.md', 'chapter_171a.md', 'chapter_172a.md', 'chapter_172b.md', 'chapter_173a.md', 'chapter_174a.md', 'chapter_174b.md', 'chapter_174c.md', 'chapter_175a.md', 'chapter_175b.md', 'chapter_176a.md', 'chapter_176b.md', 'chapter_177a.md', 'chapter_177b.md', 'chapter_178a.md', 'chapter_178b.md', 'chapter_179a.md', 'chapter_180a.md', 'chapter_181a.md', 'chapter_182a.md', 'chapter_182b.md', 'chapter_183a.md', 'chapter_183b.md', 'chapter_184a.md', 'chapter_184b.md', 'chapter_184c.md', 'chapter_185a.md', 'chapter_185b.md', 'chapter_186a.md', 'chapter_186b.md'
    ]
    
    # Process the files
    await processor.process_files(files_to_process)

if __name__ == "__main__":
    asyncio.run(main())